<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <link rel="stylesheet" type="text/css" href="print.css" />
    <meta charset="utf-8" />
    <link href="https://fonts.cdnfonts.com/css/prompt" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/monday-sdk-js/dist/main.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.3.min.js"></script>
    <script src="jquery.printelement.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jQuery.print/1.6.2/jQuery.print.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <style>
    #print_btn {
        position: absolute;
        transform: scale(1.2);
        top: 20px;
        left: 20px;
    }
    .page {
        page-break-after: always;
    }
    </style>
</head>

<body>
    <button id="print_btn">列 印</button>
    <div id='print_box'>
        <div id="title">
            <h2 id='title_text' class='not_select'>請設定標題</h2>
            <h3 id='subTitle' class='not_select'>請設定副標題</h3>
        </div>
        <div id='content'></div>
    </div>
    <script>
    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    let columnNum = parseInt(getParameterByName('columnNum')) || 2;
    let allImg = getParameterByName('iurl')
    allImg = allImg ? allImg.split(',') : [];
    let infoData = getParameterByName('data')
    let layoutDirection = getParameterByName('layoutDirection') || 'vertical';

    // 切換 body class 以配合列印方向
    if (layoutDirection === 'vertical') {
        document.body.classList.add('portrait');
        document.body.classList.remove('landscape');
    } else {
        document.body.classList.add('landscape');
        document.body.classList.remove('portrait');
    }

    // 動態產生圖片分組
    function renderImages() {
        const content = document.getElementById('content');
        content.innerHTML = '';
        if (layoutDirection === 'vertical') {
            // 直式：每 row 放 columnNum 張圖
            for (let i = 0; i < allImg.length; i += columnNum) {
                const rowDiv = document.createElement('div');
                rowDiv.style.display = 'flex';
                rowDiv.style.flexDirection = 'row';
                rowDiv.style.width = '100%';
                for (let j = 0; j < columnNum && (i + j) < allImg.length; j++) {
                    const div = document.createElement('div');
                    const div2 = document.createElement('div');
                    const img = document.createElement('img');
                    div.id = 'img_div_' + (i + j);
                    img.id = 'img_' + (i + j);
                    div2.id = 'img_div2_' + (i + j);
                    div.className = 'item_img' + columnNum;
                    div2.className = 'image_box';
                    img.src = allImg[i + j];
                    img.className = 'image';
                    div.appendChild(div2);
                    div2.appendChild(img);
                    rowDiv.appendChild(div);
                }
                content.appendChild(rowDiv);
            }
        } else {
            // 橫式：單行橫向排列
            const rowDiv = document.createElement('div');
            rowDiv.style.display = 'flex';
            rowDiv.style.flexDirection = 'row';
            rowDiv.style.width = '100%';
            for (let i = 0; i < allImg.length; i++) {
                const div = document.createElement('div');
                const div2 = document.createElement('div');
                const img = document.createElement('img');
                div.id = 'img_div_' + i;
                img.id = 'img_' + i;
                div2.id = 'img_div2_' + i;
                div.className = 'item_img' + columnNum;
                div2.className = 'image_box';
                img.src = allImg[i];
                img.className = 'image';
                div.appendChild(div2);
                div2.appendChild(img);
                rowDiv.appendChild(div);
            }
            content.appendChild(rowDiv);
        }
    }

    renderImages();

    document.getElementById('print_btn').onclick = function() {
        window.print();
    };
    </script>
</body>

</html>